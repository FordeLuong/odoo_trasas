<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- FORM VIEW -->
    <record id="view_dispatch_outgoing_form" model="ir.ui.view">
        <field name="name">trasas.dispatch.outgoing.form</field>
        <field name="model">trasas.dispatch.outgoing</field>
        <field name="arch" type="xml">
            <form string="Công văn đi">
                <header>
                    <button name="action_submit" string="Gửi duyệt" type="object" class="oe_highlight" invisible="state != 'draft'"/>
                    <button name="action_approve" string="Duyệt" type="object" class="oe_highlight" invisible="state != 'waiting_approval' or not is_user_approver"/>
                    <button name="action_reject" string="Từ chối" type="object" invisible="state != 'waiting_approval' or not is_user_approver"/>
                    <button name="action_send_to_hcns" string="Gửi cho HCNS" type="object" class="oe_highlight" invisible="state != 'approved'"/>
                    <button name="action_generate_number" string="Cấp số" type="object" class="oe_highlight" invisible="state != 'to_promulgate' or dispatch_number"/>
                    <button name="action_release" string="Phát hành" type="object" class="oe_highlight" invisible="state != 'processing'"/>
                    <button name="action_send" string="Gửi đi" type="object" class="oe_highlight" invisible="state != 'released'"/>
                    <button name="action_done" string="Hoàn thành" type="object" class="oe_highlight" invisible="state != 'sent'"/>
                    <field name="stage_id" widget="statusbar" options="{'clickable': 1}"/>
                </header>
                <sheet>
                    <field name="is_user_approver" invisible="1"/>
                    <div class="oe_title">
                        <div class="d-flex">
                            <div class="me-5" invisible="state in ('processing', 'released', 'sent', 'done')">
                                <label for="name" class="oe_edit_only"/>
                                <h1>
                                    <field name="name" readonly="1"/>
                                </h1>
                            </div>
                            <div invisible="not dispatch_number">
                                <label for="dispatch_number" class="oe_edit_only"/>
                                <h1>
                                    <field name="dispatch_number" readonly="1"/>
                                </h1>
                            </div>
                        </div>
                    </div>
                    <group>
                        <group string="Thông tin chung">
                            <field name="subject"/>
                        </group>
                        <group string="Thời gian &amp; Nơi nhận">
                            <field name="date_created"/>
                            <field name="date_promulgated"/>
                            <field name="recipient_id"/>
                        </group>
                        <group string="Người xử lý">
                            <field name="drafter_id"/>
                            <field name="department_id"/>
                            <field name="approver_id"/>
                        </group>
                        <group string="Tài liệu đính kèm">
                            <field name="draft_file" filename="draft_filename"/>
                            <field name="draft_filename" invisible="1"/>
                            <field name="official_file" filename="official_filename" readonly="state != 'processing'"/>
                            <field name="official_filename" invisible="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Nội dung chi tiết">
                            <field name="content"/>
                        </page>
                        <page string="Tài liệu đính kèm &amp; Lưu trữ">
                            <group>
                                <field name="hard_copy_location"/>
                            </group>
                            <field name="attachment_ids">
                                <list>
                                    <field name="name" string="Tên file"/>
                                    <field name="create_uid" string="Người đăng"/>
                                    <field name="create_date" string="Ngày đăng"/>
                                    <field name="file_size"/>
                                </list>
                            </field>
                        </page>
                        <page string="Ghi chú">
                            <field name="note"/>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- LIST VIEW -->
    <record id="view_dispatch_outgoing_tree" model="ir.ui.view">
        <field name="name">trasas.dispatch.outgoing.tree</field>
        <field name="model">trasas.dispatch.outgoing</field>
        <field name="arch" type="xml">
            <list string="Danh sách công văn đi" decoration-info="state == 'draft'" decoration-muted="state == 'cancel'" decoration-success="state == 'done'">
                <field name="date_promulgated" string="Ngày CV"/>
                <field name="name" string="Mã HT"/>
                <field name="dispatch_number" string="Số CV"/>
                <field name="subject" string="Nội dung"/>
                <field name="recipient_id" string="Nơi gửi đến"/>
                <field name="note" string="Ghi chú"/>
                <field name="state" widget="badge"/>
            </list>
        </field>
    </record>

    <!-- KANBAN VIEW -->
    <record id="view_dispatch_outgoing_kanban" model="ir.ui.view">
        <field name="name">trasas.dispatch.outgoing.kanban</field>
        <field name="model">trasas.dispatch.outgoing</field>
        <field name="arch" type="xml">
            <kanban default_group_by="stage_id" class="o_kanban_small_column">
                <field name="state"/>
                <field name="name"/>
                <field name="subject"/>
                <field name="drafter_id"/>
                <field name="date_created"/>
                <templates>
                    <t t-name="card">
                        <div class="oe_kanban_global_click">
                            <div class="o_kanban_record_top">
                                <div class="o_kanban_record_headings">
                                    <strong class="o_kanban_record_title"><field name="name"/> - <field name="subject"/></strong>
                                </div>
                            </div>
                            <div class="o_kanban_record_body">
                                <span class="text-muted"><field name="drafter_id"/></span>
                                <div class="text-muted"><field name="date_created"/></div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- SEARCH VIEW -->
    <!-- SEARCH VIEW -->
    <record id="view_dispatch_outgoing_search" model="ir.ui.view">
        <field name="name">trasas.dispatch.outgoing.search</field>
        <field name="model">trasas.dispatch.outgoing</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="subject"/>
                <field name="dispatch_number"/>
            </search>
        </field>
    </record>

    <!-- ACTION -->
    <record id="action_trasas_dispatch_outgoing" model="ir.actions.act_window">
        <field name="name">Công văn đi</field>
        <field name="res_model">trasas.dispatch.outgoing</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Tạo công văn đi mới đầu tiên!
            </p>
        </field>
    </record>
</odoo>
