<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <record model="ir.ui.view" id="docusign_connector_res_partner_form">
        <field name="name">docusign.connector.form</field>
        <field name="model">docusign.connector</field>
        <field name="arch" type="xml">
            <form string="Docusign">
                <header>
                    <field name="state" widget="statusbar" nolabel="1"/>
                    <button name="send_docs" type="object"
                            string="Send Documents for Signatures" icon="fa-send" class="oe_highlight"/>
                    <button string="Update Document Statuses" name="status_docs" type="object"
                            class="btn-link" icon="fa-refresh" invisible="state == 'completed'"/>
                    <button string="Download Signed Documents" name="download_docs" type="object"
                            class="oe_highlight" icon="fa-download"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="responsible_id"/>
                            <field name="model" readonly="1"/>
                            <field name="sale_id" invisible="not sale_id" readonly="1"/>
                            <field name="purchase_id" invisible="not purchase_id" readonly="1"/>
                            <field name="contact_id" invisible="not contact_id" readonly="1"/>
                        </group>
                        <group>
                            <field name="docs_policy"/>
                            <div class="oe_inline oe_info"  >
                                <p invisible="[('docs_policy', '!=', 'out')]">Documents will be sent to all recipients at the same time. Click the "Send" button to start the process, and use the "Download" button to retrieve signed documents from recipients who have completed their signatures.</p>
                                <p invisible="[('docs_policy', '!=', 'in')]">Documents will be sent one by one, following the order of the recipients listed below. Click the "Send" button to initiate the process, and after each recipient signs, click the "Download" button to retrieve their signed documents before moving to the next recipient.</p>
                            </div>
                            <field name="user_account_id"/>
                            <field name="attachment_ids" filename="my_file_fname" widget="many2many_binary"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Recipients">
                            <field name="connector_line_ids">
                                <tree editable="bottom" create="true" delete="true" edit="false">
                                    <field name="partner_id"/>
                                    <field name="email"/>
                                    <field name="status" invisible="1"/>
                                    <field name="send_status" readonly="1"/>
                                    <field name="sign_status" readonly="1"/>
                                    <field name="envelope_id" invisible="1"/>
                                    <field name="docs_policy" invisible="1"/>
                                    <field name="un_signed_attachment_ids" widget="many2many_binary" readonly="1" />
                                    <field name="signed_attachment_ids" widget="many2many_binary" readonly="1"/>
                                    <field name="record_id" invisible="1"/>
                                </tree>
                                <form>
                                    <sheet string="Docusign Connector Lines">
                                        <group>
                                            <group>
                                                <field name="partner_id"/>
                                                <field name="status"/>
                                            </group>
                                            <group>
                                                <field name="email"/>
                                            </group>
                                        </group>
                                        <group>
                                            <field name="un_signed_attachment_ids"/>
                                        </group>
                                        <group>
                                            <field name="signed_attachment_ids"/>
                                        </group>
                                        <group>
                                            <group>
                                                <field name="name"/>
                                                <field name="send_status"/>
                                                <field name="docs_policy"/>
                                                <field name="record_id"/>
                                            </group>
                                            <group>
                                                <field name="envelope_id"/>
                                                <field name="sign_status"/>
                                                <field name="recipient_id"/>
                                            </group>
                                        </group>
                                        <group>
                                            <separator/>
                                        </group>
                                    </sheet>
                                </form>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="docusign_connector_res_partner_tree">
        <field name="name">Document Records</field>
        <field name="model">docusign.connector</field>
        <field name="arch" type="xml">
            <tree string="Documents">
                <field name="name"/>
                <field name="responsible_id"/>
                <field name="model"/>
                <field name="sale_id" optional="show"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="docusign_connector_search_view">
        <field name="name">docusign.connector.search</field>
        <field name="model">docusign.connector</field>
        <field name="arch" type="xml">
            <search string="Documents">
                <field name="name" string="Sequence" filter_domain="[('name','ilike',self)]"/>
                <field name="responsible_id" string="Responsible"/>
                <field name="connector_line_ids" string="Partner" filter_domain="[('connector_line_ids.partner_id','ilike',self)]"/>
                <field name="state"/>
                <field name="model"/>
                <separator/>
                <filter string="New" name="filter_new" domain="[('state','=','new')]"/>
                <filter string="Open" name="filter_open" domain="[('state','=','open')]"/>
                <filter string="Sent" name="filter_sent" domain="[('state','=','sent')]"/>
                <filter string="Customer Signed" name="filter_customer" domain="[('state','=','customer')]"/>
                <filter string="Completed" name="filter_completed" domain="[('state','=','completed')]"/>
                <separator/>
                <group expand="0" string="Group By">
                    <filter string="Responsible" name="group_responsible" context="{'group_by':'responsible_id'}"/>
                    <filter string="State" name="group_state" context="{'group_by':'state'}"/>
                    <filter string="Model" name="group_model" context="{'group_by':'model'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="docusign_connector_res_partner_action" model="ir.actions.act_window">
        <field name="name">Docusign Menu</field>
        <field name="res_model">docusign.connector</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem id="docusign_menu" web_icon="odoo_docusign,static/description/icon.png" name="Docusign" action="docusign_connector_res_partner_action"
              groups="base.group_user"/>
    <menuitem id="docusign_menu_dashboard" name="Documents" parent="docusign_menu"
              action="docusign_connector_res_partner_action" sequence="1"/>

    <menuitem id="docusign_menu_users" name="Configurations" parent="docusign_menu"
              action="base.action_res_users" sequence="2"/>

</odoo>
